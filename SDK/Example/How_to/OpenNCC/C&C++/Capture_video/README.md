# Background

In order to let you better understand openncc, we launched this demo, which can output YUV, h26x and mjpg video streams.Yuv uses opencv to display directly, and a Mjpeg picture saved locally.At the same time a h26x saved locally and can be played by ffplay .  Demo has been tested on Raspberry pi and Ubuntu(usb 3.0), NVIDIA.

# Install

This demo uses libusb,ffmpeg and opencv.Go check them out if you don't have them locally installed.

```shell
$ sudo apt-get install libusb-dev  libusb-1.0-0-dev
$ sudo apt-get install ffmpeg
$ sudo apt-get install libopencv-dev
```

Note:if you want to copy the command to the command line,remember to remove `$`.

# Usage

1. If you want to learn available targets.

```makefile
$ make help
```

2. To clone or update the required libraries.

```makefile
$ make clone
```

3. To clone libraries and build the project.

```makefile
$ make all
```

4. To build and run the project.

```makefile
$ make run
```

5. To clean the object (.o) and executable files generated by make.

```makefile
$ make clean
```



**NVIDIA (arm64)**

Because opencv installed is 4.1.1, so you need to change the content in your Makefile.

Change 
```shell
OPENCV = `pkg-config opencv --cflags --libs`
```
to 
```shell
OPENCV = `pkg-config opencv4 --cflags --libs`
```

add `$(OPENCV)` after `COMMFLAG = -DUSE_WD`
like `COMMFLAG = -DUSE_WD $(OPENCV)`

then

```makefile
$ make run
```

Note: If you are a Raspberry pi user,  you may encounter the following problems 

**<font color="red">Note: You may come across problems that need keys</font>**

```shell
Firmvare version:MV02.101.17 Device SN:xxxxxxxxxxxxx
07:17:13 : sdk/sdk.cpp(667) need check key file ./fw/eyecloud.key from firm:./fw/flicRefApp.mvcmd pos 4
07:17:13 : sdk/sdk.cpp(671) no find eyecloud key file and no support!
load firmware error! return
```

At this time,  you need to send the SN number to `info@eyecloud.tech`, and we will generate a key file for you.

copy key file to `bin/fw` like this.

```shell
cp ~/eyecloud.key ./fw/
```

 Now,you can run

```makefile
$ make run
```

4. How to play JPEG and H26x after running demo 

```
mjepg:    demo automatically saves MJPEG pictures
h26x Preview: ffplay x_x.h26x
```

# Demo introduce 

1. USB load firmware

   ```c++
   load_fw();
   ```

2. Get the current camera mode support list，Including resolution and frame rate

   ```c++
   camera_control_get_features();
   ```

3. Select camera working mode

   ```c++
   camera_select_sensor();
   ```

4. Configure device resoures

   ```c++
   cam_info.imageWidth   = cameraCfg.camWidth;　
   cam_info.imageHeight  = cameraCfg.camHeight;　　
   cam_info.isOutputYUV  = 1;　　　　　　　　　　//Initialize YUV output
   cam_info.isOutputH26X = 1;　　　　　　　　　　//Initialize H26X output
   cam_info.isOutputJPEG = 1;          //Initialize MJPEG output
   cam_info.mode         = ENCODE_H264_MODE;    //Select H26X encoding mode, 264/265
   ```

5. Create receiving thread
   5.1 Turn on YUVdata output switch	(isOutputYUV must be set to 1)

   ```c++
   camera_yuv420_out(YUV420_OUT_SINGLE);　　　//Output single frame
   camera_yuv420_out(YUV420_OUT_CONTINUOUS);　//Output continuous frames 
   camera_yuv420_out(YUV420_OUT_DISABLE);　   //turn off output
   ```

   5.2  Turn on MJPEGdata output switch(isOutputJPEG must be set to 1)

   ```c++
   camera_mjpeg_out(MJPEG_OUT_SINGLE); 　　　　//Output single frame
   camera_mjpeg_out(MJPEG_OUT_CONTINUOUS); 　　//Output continuous frames
   camera_mjpeg_out(MJPEG_OUT_DISABLE); 　　   //turn off output
   ```

   5.3  Turn on H26x output switch(isOutputH26X must be set to 1)

   ```c++
   camera_h26x_out(H26X_OUT_ENABLE); 　　　　   //Turn on output
   camera_h26x_out(H26X_OUT_DISABLE); 　　　　　//turn off output　
   ```

## Maintainers

Beam.

Zed.
